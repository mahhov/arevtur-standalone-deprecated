<style>
	#results-container {
		display: flex;
		align-items: flex-start;
	}

	#results-list {
		flex: 1;
	}

	#results-list .item {
		margin: 10px;
	}
</style>

<div id="results-container">
	<div id="results-list"></div>
	<x-chart id="results-chart" width="400" height="400"></x-chart>
</div>

<script>
	require('./xElements/import');
	const DataFetcher = require('./DataFetcher');

	const $ = document.querySelector.bind(document);
	const $c = (tag, classList = [], text = '', parent = null) => {
		let el = document.createElement(tag);
		el.classList.add(...classList);
		el.textContent = text;
		if (parent)
			parent.appendChild(el);
		return el;
	};

	let load = async () => {
		let weights = {
			[DataFetcher.PROPERTIES.flatLife]: 2,
			[DataFetcher.PROPERTIES.totalEleRes]: 1,
		};
		let query = DataFetcher.formQuery(DataFetcher.TYPES.boots, weights, 0, 2, DataFetcher.SORT.price);
		let itemsData = await DataFetcher.getItems(query);

		let itemsToPoints = items =>
			items.map(item => ({x: item.evalPrice, y: item.evalValue}));

		$('#results-chart').pointSets = [
			{
				color: 'rgb(0,0,0)',
				size: 4,
				points: itemsToPoints(itemsData.items),
			}, {
				color: 'rgb(0,0,255)',
				size: 6,
				points: itemsToPoints(itemsData.borderlineItems),
			},
		];

		itemsData.items.forEach(itemData =>
			$c('x-item-listing', ['item'], '', $('#results-list')).itemData = itemData);
	};
	load();


	// todo
	// display query proguress status
	// ui to form and persist query
	// convert armor and socket requirements to fuzzy query
	// multi-filter (e.g. & 30 movespeed; & not can't use body)
	// assume quality 0%
	// free affixes
	// expand price range

</script>
